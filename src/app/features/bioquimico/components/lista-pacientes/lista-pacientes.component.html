<div class="container">
  <div class="lista-wrapper">
    <!-- Header -->
    <div class="page-header">
      <div>
        <h2>Pacientes Cadastrados</h2>
        <p class="text-muted">Gerencie os pacientes do sistema</p>
      </div>
      <button class="btn btn-primary" (click)="novoPaciente()">
        <span class="icon">+</span>
        Novo Paciente
      </button>
    </div>

    <!-- Mensagem de erro -->
    <div class="alert alert-error" *ngIf="errorMessage">
      {{ errorMessage }}
    </div>

    <!-- Filtros -->
    <div class="card filters-card">
      <div class="filters-row">
        <div class="filter-group">
          <label for="filtroTipo">Buscar por:</label>
          <select 
            id="filtroTipo" 
            [(ngModel)]="filtroTipo"
            class="form-control"
          >
            <option value="nome">Nome</option>
            <option value="cpf">CPF</option>
            <option value="cns">CNS</option>
          </select>
        </div>

        <div class="filter-group flex-grow">
          <label for="searchTerm">
            <span *ngIf="filtroTipo === 'nome'">Nome do Paciente</span>
            <span *ngIf="filtroTipo === 'cpf'">CPF</span>
            <span *ngIf="filtroTipo === 'cns'">CNS</span>
          </label>
          <div class="search-input-group">
            <input 
              type="text" 
              id="searchTerm"
              [(ngModel)]="searchTerm"
              class="form-control"
              [placeholder]="filtroTipo === 'nome' ? 'Digite o nome do paciente...' : 
                             filtroTipo === 'cpf' ? 'Digite o CPF...' : 
                             'Digite o CNS...'"
            >
            <button 
              type="button" 
              class="btn btn-primary"
              (click)="buscarPacientes()"
              [disabled]="buscandoPacientes || !searchTerm || searchTerm.length < 3"
            >
              <span *ngIf="!buscandoPacientes">Pesquisar</span>
              <span *ngIf="buscandoPacientes">Buscando...</span>
            </button>
          </div>
        </div>

        <div class="filter-actions">
          <button 
            class="btn btn-secondary btn-sm"
            (click)="limparFiltros()"
            *ngIf="searchTerm"
          >
            Limpar
          </button>
        </div>
      </div>

      <div class="results-info">
        <span>
          Exibindo <strong>{{ pacientesPaginados.length }}</strong> de 
          <strong>{{ pacientesFiltrados.length }}</strong> pacientes
          <span *ngIf="pacientesFiltrados.length !== pacientes.length">
            (filtrado de {{ pacientes.length }} no total)
          </span>
        </span>
      </div>
    </div>

    <!-- Tabela -->
    <div class="card table-card">
      <!-- Loading -->
      <div class="loading-container" *ngIf="isLoading">
        <div class="spinner"></div>
        <p>Carregando pacientes...</p>
      </div>

      <!-- Tabela de pacientes -->
      <div class="table-responsive" *ngIf="!isLoading && pacientesPaginados.length > 0">
        <table class="table">
          <thead>
            <tr>
              <th>Nome</th>
              <th>CPF</th>
              <th>CNS</th>
              <th>Data Nascimento</th>
              <th>Idade</th>
              <th>Telefone</th>
              <th class="text-center">AÃ§Ãµes</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let paciente of pacientesPaginados">
              <td>
                <div class="paciente-nome">
                  <strong>{{ paciente.nome }}</strong>
                  <small class="text-muted" *ngIf="paciente.email">{{ paciente.email }}</small>
                </div>
              </td>
              <td>{{ paciente.cpf | cpf }}</td>
              <td>
                <span *ngIf="paciente.cns">{{ paciente.cns | cns }}</span>
                <span *ngIf="!paciente.cns" class="text-muted">-</span>
              </td>
              <td>{{ formatarData(paciente.dataNascimento) }}</td>
              <td>{{ calcularIdade(paciente.dataNascimento) }} anos</td>
              <td>{{ paciente.telefone | telefone }}</td>
              <td>
                <div class="actions">
                  <button 
                    class="btn-action btn-view"
                    (click)="visualizarPaciente(paciente)"
                    title="Visualizar"
                  >
                    ğŸ‘ï¸
                  </button>
                  <button 
                    class="btn-action btn-edit"
                    (click)="editarPaciente(paciente)"
                    title="Editar"
                  >
                    âœï¸
                  </button>
                  <button 
                    class="btn-action btn-delete"
                    (click)="desativarPaciente(paciente)"
                    title="Desativar"
                  >
                    ğŸ—‘ï¸
                  </button>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Mensagem quando nÃ£o hÃ¡ pacientes -->
      <div class="empty-state" *ngIf="!isLoading && pacientesPaginados.length === 0">
        <div class="empty-icon">ğŸ“‹</div>
        <h3>Nenhum paciente encontrado</h3>
        <p *ngIf="searchTerm">
          Tente ajustar os filtros de busca ou 
          <button class="btn-link" (click)="limparFiltros()">limpar filtros</button>
        </p>
        <p *ngIf="!searchTerm">
          Comece cadastrando um novo paciente ou faÃ§a uma busca
        </p>
        <button class="btn btn-primary mt-3" (click)="novoPaciente()">
          Cadastrar Primeiro Paciente
        </button>
      </div>

      <!-- PaginaÃ§Ã£o -->
      <div class="pagination" *ngIf="!isLoading && totalPaginas > 1">
        <button 
          class="pagination-btn"
          [disabled]="paginaAtual === 1"
          (click)="irParaPagina(1)"
        >
          Â«Â«
        </button>
        
        <button 
          class="pagination-btn"
          [disabled]="paginaAtual === 1"
          (click)="irParaPagina(paginaAtual - 1)"
        >
          â€¹
        </button>

        <button 
          *ngFor="let pagina of paginasVisiveis"
          class="pagination-btn"
          [class.active]="pagina === paginaAtual"
          (click)="irParaPagina(pagina)"
        >
          {{ pagina }}
        </button>

        <button 
          class="pagination-btn"
          [disabled]="paginaAtual === totalPaginas"
          (click)="irParaPagina(paginaAtual + 1)"
        >
          â€º
        </button>

        <button 
          class="pagination-btn"
          [disabled]="paginaAtual === totalPaginas"
          (click)="irParaPagina(totalPaginas)"
        >
          Â»Â»
        </button>
      </div>
    </div>
  </div>
</div>
