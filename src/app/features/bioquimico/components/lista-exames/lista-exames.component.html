<div class="container">
  <div class="lista-wrapper">
    <!-- Header -->
    <div class="page-header">
      <div>
        <h2>Exames Cadastrados</h2>
        <p class="text-muted">Gerencie os exames laboratoriais do sistema</p>
      </div>
      <button class="btn btn-primary" (click)="novoExame()">
        <span class="icon">+</span>
        Novo Exame
      </button>
    </div>

    <!-- Mensagem de erro -->
    <div class="alert alert-error" *ngIf="errorMessage">
      {{ errorMessage }}
    </div>

    <!-- Filtros -->
    <div class="card filters-card">
      <div class="filters-row">
        <div class="filter-group">
          <label for="filtroStatus">Status:</label>
          <select 
            id="filtroStatus" 
            [(ngModel)]="filtroStatus"
            (change)="aplicarFiltros()"
            class="form-control"
          >
            <option value="todos">Todos</option>
            <option value="pendente">Pendente</option>
            <option value="liberado">Liberado</option>
            <option value="cancelado">Cancelado</option>
          </select>
        </div>

        <div class="filter-group">
          <label for="filtroTipo">Tipo:</label>
          <select 
            id="filtroTipo" 
            [(ngModel)]="filtroTipo"
            (change)="aplicarFiltros()"
            class="form-control"
          >
            <option value="todos">Todos</option>
            <option value="hemograma">Hemograma</option>
            <option value="urina">Urina</option>
            <option value="fezes">Fezes</option>
          </select>
        </div>

        <div class="filter-group flex-grow">
          <label for="searchTerm">Pesquisar:</label>
          <input 
            type="text" 
            id="searchTerm"
            [(ngModel)]="searchTerm"
            (input)="aplicarFiltros()"
            class="form-control"
            placeholder="C√≥digo, paciente ou CPF..."
          >
        </div>

        <div class="filter-actions">
          <button 
            class="btn btn-secondary btn-sm"
            (click)="limparFiltros()"
            *ngIf="searchTerm || filtroStatus !== 'todos' || filtroTipo !== 'todos'"
          >
            Limpar
          </button>
        </div>
      </div>

      <div class="results-info">
        <span>
          Exibindo <strong>{{ examesPaginados.length }}</strong> de 
          <strong>{{ examesFiltrados.length }}</strong> exames
        </span>
      </div>
    </div>

    <!-- Tabela -->
    <div class="card table-card">
      <!-- Loading -->
      <div class="loading-container" *ngIf="isLoading">
        <div class="spinner"></div>
        <p>Carregando exames...</p>
      </div>

      <!-- Tabela de exames -->
      <div class="table-responsive" *ngIf="!isLoading && examesPaginados.length > 0">
        <table class="table">
          <thead>
            <tr>
              <th>C√≥digo</th>
              <th>Paciente</th>
              <th>Tipo</th>
              <th>Data Coleta</th>
              <th>Status</th>
              <th>Alterados</th>
              <th class="text-center">A√ß√µes</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let exame of examesPaginados">
              <td>
                <strong class="codigo-exame">{{ exame.codigo }}</strong>
                <small class="dias-coleta" *ngIf="exame.status === 'pendente'">
                  {{ diasDesdeColeta(exame.dataColeta) }} dia(s)
                </small>
              </td>
              <td>
                <div class="paciente-info">
                  <strong>{{ exame.pacienteNome }}</strong>
                  <small>{{ exame.pacienteCpf | cpf }}</small>
                </div>
              </td>
              <td>{{ getTipoExameLabel(exame.tipoExame) }}</td>
              <td>{{ formatarData(exame.dataColeta) }}</td>
              <td>
                <span class="badge" [ngClass]="getStatusClass(exame.status)">
                  {{ exame.status }}
                </span>
              </td>
              <td>
                <span class="alterados-badge" *ngIf="contarValoresAlterados(exame) > 0">
                  <span class="badge badge-warning">
                    {{ contarValoresAlterados(exame) }}
                  </span>
                </span>
                <span *ngIf="contarValoresAlterados(exame) === 0" class="text-muted">-</span>
              </td>
              <td>
                <div class="actions">
                  <button 
                    class="btn-action btn-view"
                    (click)="visualizarExame(exame)"
                    title="Visualizar"
                  >
                    üëÅÔ∏è
                  </button>
                  <button 
                    class="btn-action btn-edit"
                    (click)="editarExame(exame)"
                    [disabled]="exame.status !== 'pendente'"
                    title="Editar"
                  >
                    ‚úèÔ∏è
                  </button>
                  <button 
                    class="btn-action btn-liberar"
                    (click)="liberarExame(exame)"
                    [disabled]="exame.status !== 'pendente'"
                    title="Liberar"
                  >
                    ‚úì
                  </button>
                  <button 
                    class="btn-action btn-delete"
                    (click)="cancelarExame(exame)"
                    [disabled]="exame.status === 'cancelado'"
                    title="Cancelar"
                  >
                    ‚úï
                  </button>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Mensagem quando n√£o h√° exames -->
      <div class="empty-state" *ngIf="!isLoading && examesPaginados.length === 0">
        <div class="empty-icon">üî¨</div>
        <h3>Nenhum exame encontrado</h3>
        <p *ngIf="searchTerm || filtroStatus !== 'todos' || filtroTipo !== 'todos'">
          Tente ajustar os filtros de busca ou 
          <button class="btn-link" (click)="limparFiltros()">limpar filtros</button>
        </p>
        <p *ngIf="!searchTerm && filtroStatus === 'todos' && filtroTipo === 'todos'">
          Comece cadastrando um novo exame
        </p>
        <button class="btn btn-primary mt-3" (click)="novoExame()">
          Cadastrar Primeiro Exame
        </button>
      </div>

      <!-- Pagina√ß√£o -->
      <div class="pagination" *ngIf="!isLoading && totalPaginas > 1">
        <button 
          class="pagination-btn"
          [disabled]="paginaAtual === 1"
          (click)="irParaPagina(1)"
        >
          ¬´¬´
        </button>
        
        <button 
          class="pagination-btn"
          [disabled]="paginaAtual === 1"
          (click)="irParaPagina(paginaAtual - 1)"
        >
          ‚Äπ
        </button>

        <button 
          *ngFor="let pagina of paginasVisiveis"
          class="pagination-btn"
          [class.active]="pagina === paginaAtual"
          (click)="irParaPagina(pagina)"
        >
          {{ pagina }}
        </button>

        <button 
          class="pagination-btn"
          [disabled]="paginaAtual === totalPaginas"
          (click)="irParaPagina(paginaAtual + 1)"
        >
          ‚Ä∫
        </button>

        <button 
          class="pagination-btn"
          [disabled]="paginaAtual === totalPaginas"
          (click)="irParaPagina(totalPaginas)"
        >
          ¬ª¬ª
        </button>
      </div>
    </div>
  </div>
</div>
